import * as Sharing from 'expo-sharing';
import * as FileSystem from 'expo-file-system';
import React from 'react';
import { Image } from 'react-native';
import Svg, { Path, Rect, G, Defs, ClipPath } from 'react-native-svg';
import { TouchableOpacity } from 'react-native-gesture-handler';

import Analytics, { events } from '@covid/core/Analytics';
import { shareVaccine } from '@assets';
import i18n from '@covid/locale/i18n';

interface Props {
  screenName: string;
}

export const DashboardLogVaccine: React.FC<Props> = ({ screenName }) => {
  const onShareImage = async () => {
    try {
      const uri = Image.resolveAssetSource(shareVaccine).uri;
      const downloadPath = FileSystem.cacheDirectory + 'ShareVaccine.png';
      const { uri: localUrl } = await FileSystem.downloadAsync(uri, downloadPath);

      const shared = await Sharing.shareAsync(localUrl, {
        mimeType: 'image/png',
        dialogTitle: i18n.t('share-log-vaccine'),
      });
      trackShare();
    } catch (_) {}
  };

  const trackShare = () => {
    Analytics.track(events.LOG_YOUR_VACCINE_SHARED, { screenName });
  };

  return (
    <TouchableOpacity style={{ marginLeft: -14, marginTop: -30 }} onPress={onShareImage}>
      {svgButton}
    </TouchableOpacity>
  );
};

const svgButton = (
  <Svg width={380} height={190} viewBox="0 0 380 180" fill="none" xmlns="http://www.w3.org/2000/svg">
    <G filter="url(#prefix__filter0_d)">
      <G clipPath="url(#prefix__clip0)">
        <Rect x={30} y={30} width={343} height={146} rx={16} fill="#0165B5" />
        <Path
          d="M272.609 130l6.239 5.657-6.239 5.657"
          stroke="#fff"
          strokeWidth={1.5}
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <Path
          d="M161.13 140.168c1.946 0 3.262-1.302 3.262-2.912 0-1.414-1.022-2.296-2.646-2.702l-1.218-.308c-1.218-.308-1.316-.952-1.316-1.26 0-.882.812-1.484 1.722-1.484.994 0 1.708.63 1.708 1.54h1.428c0-1.764-1.358-2.856-3.094-2.856-1.708 0-3.206 1.134-3.206 2.828 0 .798.336 2.016 2.394 2.534l1.232.308c.784.21 1.554.616 1.554 1.47 0 .798-.672 1.526-1.82 1.526-1.204 0-1.974-.798-2.002-1.624H157.7c0 1.554 1.372 2.94 3.43 2.94zm8.544-6.874c-.882 0-1.834.406-2.268 1.148v-.98h-1.372v9.716h1.372v-4.144c.434.742 1.344 1.134 2.268 1.134 1.778 0 3.248-1.344 3.248-3.43 0-2.072-1.484-3.444-3.248-3.444zm-.168 5.586a2.107 2.107 0 01-2.086-2.128c0-1.316.994-2.17 2.086-2.17 1.134 0 2.03.938 2.03 2.17s-.896 2.128-2.03 2.128zm8.265-5.586c-.84 0-1.498.49-1.834 1.638v-1.47h-1.386V140h1.386v-2.352c0-1.764.56-3.038 1.75-3.038.266 0 .602.056.966.224l.238-1.302c-.21-.126-.672-.238-1.12-.238zm8.329 3.402c0-2.058-1.414-3.402-3.276-3.402-1.862 0-3.374 1.344-3.374 3.416s1.484 3.458 3.374 3.458c1.246 0 2.422-.588 2.996-1.68l-1.092-.546c-.364.602-1.078.952-1.834.952-1.064 0-1.848-.546-2.03-1.61h5.208c.014-.21.028-.406.028-.588zm-5.222-.518c.196-1.092.952-1.61 1.96-1.61s1.764.588 1.89 1.61h-3.85zm11.908-2.716v.98c-.42-.742-1.33-1.148-2.268-1.148-1.82 0-3.234 1.484-3.234 3.43 0 2.03 1.498 3.444 3.178 3.444.994 0 1.904-.518 2.324-1.288V140h1.372v-6.538h-1.372zm-2.086 5.418c-1.148 0-2.044-.98-2.044-2.156 0-1.162.896-2.142 2.016-2.142 1.05 0 2.1.882 2.1 2.142 0 1.232-.98 2.156-2.072 2.156zm10.604-8.974v4.522c-.434-.742-1.344-1.134-2.268-1.134-1.764 0-3.234 1.344-3.234 3.43 0 2.072 1.47 3.444 3.248 3.444.882 0 1.82-.406 2.254-1.148v.98h1.372v-10.094h-1.372zm-2.1 8.974c-1.12 0-2.03-.952-2.03-2.17 0-1.232.91-2.128 2.03-2.128 1.008 0 2.086.812 2.086 2.128s-.98 2.17-2.086 2.17zm12.325-5.418h-1.4v-2.45h-1.372v2.45h-1.176v1.148h1.176V140h1.372v-5.39h1.4v-1.148zm4.804-.168c-.7 0-1.75.364-2.128 1.162v-4.55h-1.372V140h1.372v-3.514c0-1.344 1.036-1.848 1.89-1.848.84 0 1.484.644 1.484 1.708V140h1.372v-3.738c.014-1.862-.966-2.968-2.618-2.968zm10.81 3.402c0-2.058-1.414-3.402-3.276-3.402-1.862 0-3.374 1.344-3.374 3.416s1.484 3.458 3.374 3.458c1.246 0 2.422-.588 2.996-1.68l-1.092-.546c-.364.602-1.078.952-1.834.952-1.064 0-1.848-.546-2.03-1.61h5.208c.014-.21.028-.406.028-.588zm-5.222-.518c.196-1.092.952-1.61 1.96-1.61s1.764.588 1.89 1.61h-3.85zm18.419-2.716l-1.554 4.466-1.568-4.466h-1.288l-1.554 4.466-1.568-4.466h-1.484l2.478 6.538h1.134l1.638-4.69 1.694 4.69h1.162l2.394-6.538h-1.484zm5.594 6.706c1.862 0 3.444-1.372 3.444-3.444s-1.582-3.43-3.444-3.43c-1.862 0-3.43 1.358-3.43 3.43s1.568 3.444 3.43 3.444zm0-1.288c-1.12 0-2.058-.882-2.058-2.156 0-1.26.938-2.142 2.058-2.142 1.12 0 2.072.882 2.072 2.142 0 1.274-.952 2.156-2.072 2.156zm8.29-5.586c-.84 0-1.498.49-1.834 1.638v-1.47h-1.386V140h1.386v-2.352c0-1.764.56-3.038 1.75-3.038.266 0 .602.056.966.224l.238-1.302c-.21-.126-.672-.238-1.12-.238zm7.195-3.388v4.522c-.434-.742-1.344-1.134-2.268-1.134-1.764 0-3.234 1.344-3.234 3.43 0 2.072 1.47 3.444 3.248 3.444.882 0 1.82-.406 2.254-1.148v.98h1.372v-10.094h-1.372zm-2.1 8.974c-1.12 0-2.03-.952-2.03-2.17 0-1.232.91-2.128 2.03-2.128 1.008 0 2.086.812 2.086 2.128s-.98 2.17-2.086 2.17z"
          fill="#fff"
        />
        <Path
          d="M166.594 67.598h-9.234v1.692h3.69V80h1.854V69.29h3.69v-1.692zm8.097 8.154c0-2.646-1.818-4.374-4.212-4.374-2.394 0-4.338 1.728-4.338 4.392 0 2.664 1.908 4.446 4.338 4.446 1.602 0 3.114-.756 3.852-2.16l-1.404-.702c-.468.774-1.386 1.224-2.358 1.224-1.368 0-2.376-.702-2.61-2.07h6.696c.018-.27.036-.522.036-.756zm-6.714-.666c.252-1.404 1.224-2.07 2.52-2.07s2.268.756 2.43 2.07h-4.95zM176.736 80h1.764V67.022h-1.764V80zm4.412 0h1.764V67.022h-1.764V80zm12.765.216c2.394 0 4.428-1.764 4.428-4.428 0-2.664-2.034-4.41-4.428-4.41s-4.41 1.746-4.41 4.41 2.016 4.428 4.41 4.428zm0-1.656c-1.44 0-2.646-1.134-2.646-2.772 0-1.62 1.206-2.754 2.646-2.754s2.664 1.134 2.664 2.754c0 1.638-1.224 2.772-2.664 2.772zm10.626-6.966h-1.8v-3.15h-1.764v3.15h-1.512v1.476h1.512V80h1.764v-6.93h1.8v-1.476zm6.175-.216c-.9 0-2.25.468-2.736 1.494v-5.85h-1.764V80h1.764v-4.518c0-1.728 1.332-2.376 2.43-2.376 1.08 0 1.908.828 1.908 2.196V80h1.764v-4.806c.018-2.394-1.242-3.816-3.366-3.816zm13.899 4.374c0-2.646-1.818-4.374-4.212-4.374-2.394 0-4.338 1.728-4.338 4.392 0 2.664 1.908 4.446 4.338 4.446 1.602 0 3.114-.756 3.852-2.16l-1.404-.702c-.468.774-1.386 1.224-2.358 1.224-1.368 0-2.376-.702-2.61-2.07h6.696c.018-.27.036-.522.036-.756zm-6.714-.666c.252-1.404 1.224-2.07 2.52-2.07s2.268.756 2.43 2.07h-4.95zm12.899-3.708c-1.08 0-1.926.63-2.358 2.106v-1.89h-1.782V80h1.782v-3.024c0-2.268.72-3.906 2.25-3.906.342 0 .774.072 1.242.288l.306-1.674c-.27-.162-.864-.306-1.44-.306zm5.413 8.838c1.728 0 3.312-.972 3.312-2.574 0-.9-.396-2.016-2.196-2.466l-1.278-.306c-.522-.126-1.008-.414-1.008-.936 0-.576.504-1.062 1.242-1.062.63 0 1.26.414 1.26 1.026h1.692c0-1.764-1.548-2.52-2.988-2.52-1.746 0-2.988 1.134-2.988 2.502 0 1.242.72 2.052 2.286 2.466l1.134.27c.63.144 1.08.432 1.08.99 0 .63-.594 1.116-1.566 1.116-.954 0-1.548-.576-1.548-1.242h-1.638c.036 1.764 1.638 2.736 3.204 2.736zm14.137-8.622h-1.8v-3.15h-1.764v3.15h-1.512v1.476h1.512V80h1.764v-6.93h1.8v-1.476zm5.387 8.622c2.394 0 4.428-1.764 4.428-4.428 0-2.664-2.034-4.41-4.428-4.41s-4.41 1.746-4.41 4.41 2.016 4.428 4.41 4.428zm0-1.656c-1.44 0-2.646-1.134-2.646-2.772 0-1.62 1.206-2.754 2.646-2.754s2.664 1.134 2.664 2.754c0 1.638-1.224 2.772-2.664 2.772zM266.736 80h1.764V67.022h-1.764V80zm8.282.216c2.394 0 4.428-1.764 4.428-4.428 0-2.664-2.034-4.41-4.428-4.41s-4.41 1.746-4.41 4.41 2.016 4.428 4.41 4.428zm0-1.656c-1.44 0-2.646-1.134-2.646-2.772 0-1.62 1.206-2.754 2.646-2.754s2.664 1.134 2.664 2.754c0 1.638-1.224 2.772-2.664 2.772zm13.071-6.966v1.224c-.576-.936-1.746-1.44-2.916-1.44-2.268 0-4.158 1.728-4.158 4.41 0 2.664 1.89 4.428 4.176 4.428 1.116 0 2.322-.522 2.898-1.44v.216c0 2.664-1.098 3.672-2.862 3.672-.918 0-1.89-.522-2.358-1.422l-1.494.738a4.31 4.31 0 003.852 2.322c2.826 0 4.626-1.548 4.626-5.454v-7.254h-1.764zm-2.7 6.966c-1.44 0-2.61-1.224-2.61-2.79 0-1.584 1.17-2.736 2.61-2.736 1.296 0 2.682 1.044 2.682 2.736 0 1.692-1.26 2.79-2.682 2.79zM162.58 95.594h-1.8v-3.15h-1.764v3.15h-1.512v1.476h1.512V104h1.764v-6.93h1.8v-1.476zm6.175-.216c-.9 0-2.25.468-2.736 1.494v-5.85h-1.764V104h1.764v-4.518c0-1.728 1.332-2.376 2.43-2.376 1.08 0 1.908.828 1.908 2.196V104h1.764v-4.806c.018-2.394-1.242-3.816-3.366-3.816zm13.899 4.374c0-2.646-1.818-4.374-4.212-4.374-2.394 0-4.338 1.728-4.338 4.392 0 2.664 1.908 4.446 4.338 4.446 1.602 0 3.114-.756 3.852-2.16l-1.404-.702c-.468.774-1.386 1.224-2.358 1.224-1.368 0-2.376-.702-2.61-2.07h6.696c.018-.27.036-.522.036-.756zm-6.714-.666c.252-1.404 1.224-2.07 2.52-2.07s2.268.756 2.43 2.07h-4.95zm9.641-5.418c.666 0 1.206-.486 1.206-1.134 0-.648-.54-1.134-1.206-1.134-.648 0-1.206.486-1.206 1.134 0 .648.558 1.134 1.206 1.134zM184.699 104h1.764v-8.406h-1.764V104zm8.552-8.622c-1.08 0-1.926.63-2.358 2.106v-1.89h-1.782V104h1.782v-3.024c0-2.268.72-3.906 2.25-3.906.342 0 .774.072 1.242.288l.306-1.674c-.27-.162-.864-.306-1.44-.306zm12.587.216l-2.448 6.12-2.448-6.12h-1.89l3.51 8.406h1.674l3.51-8.406h-1.908zm9.776 0v1.26c-.54-.954-1.71-1.476-2.916-1.476-2.34 0-4.158 1.908-4.158 4.41 0 2.61 1.926 4.428 4.086 4.428 1.278 0 2.448-.666 2.988-1.656V104h1.764v-8.406h-1.764zm-2.682 6.966c-1.476 0-2.628-1.26-2.628-2.772 0-1.494 1.152-2.754 2.592-2.754 1.35 0 2.7 1.134 2.7 2.754 0 1.584-1.26 2.772-2.664 2.772zm11.077 1.656c1.368 0 2.538-.558 3.276-1.44l-1.17-1.098c-.486.54-1.224.882-2.07.882-1.566 0-2.808-1.17-2.808-2.772 0-1.602 1.242-2.754 2.808-2.754.846 0 1.584.342 2.07.882l1.17-1.098c-.738-.882-1.908-1.44-3.276-1.44-2.43 0-4.536 1.746-4.536 4.41s2.106 4.428 4.536 4.428zm8.983 0c1.368 0 2.538-.558 3.276-1.44l-1.17-1.098c-.486.54-1.224.882-2.07.882-1.566 0-2.808-1.17-2.808-2.772 0-1.602 1.242-2.754 2.808-2.754.846 0 1.584.342 2.07.882l1.17-1.098c-.738-.882-1.908-1.44-3.276-1.44-2.43 0-4.536 1.746-4.536 4.41s2.106 4.428 4.536 4.428zm6.061-10.548c.666 0 1.206-.486 1.206-1.134 0-.648-.54-1.134-1.206-1.134-.648 0-1.206.486-1.206 1.134 0 .648.558 1.134 1.206 1.134zM238.171 104h1.764v-8.406h-1.764V104zm8.913-8.622c-.9 0-2.25.468-2.736 1.512v-1.296h-1.764V104h1.764v-4.518c0-1.746 1.332-2.376 2.43-2.376 1.08 0 1.908.828 1.908 2.196V104h1.764v-4.806c.018-2.394-1.242-3.816-3.366-3.816zm13.898 4.374c0-2.646-1.818-4.374-4.212-4.374-2.394 0-4.338 1.728-4.338 4.392 0 2.664 1.908 4.446 4.338 4.446 1.602 0 3.114-.756 3.852-2.16l-1.404-.702c-.468.774-1.386 1.224-2.358 1.224-1.368 0-2.376-.702-2.61-2.07h6.696c.018-.27.036-.522.036-.756zm-6.714-.666c.252-1.404 1.224-2.07 2.52-2.07s2.268.756 2.43 2.07h-4.95z"
          fill="#EEEEEF"
        />
        <Path
          d="M77.488 71.626a6.487 6.487 0 018.372-3.75l16.972 6.47a6.487 6.487 0 013.751 8.371l-23.915 62.736-29.096-11.091 23.916-62.736z"
          fill="#fff"
        />
        <Path
          d="M77.488 71.626a6.487 6.487 0 018.372-3.75l3.637 1.386-26.226 68.797-9.699-3.697 23.916-62.736z"
          fill="#F7F7F7"
        />
        <Path
          opacity={0.5}
          d="M79.09 77.442a6.487 6.487 0 018.372-3.75l10.304 3.928a6.487 6.487 0 013.751 8.372l-6.008 15.76-33.345 20.091 16.926-44.4z"
          fill="#0165B5"
        />
        <Path fill="#fff" d="M58.188 144.105l14.548 5.546-7.741 20.306-14.548-5.546z" />
        <Path fill="#F7F7F7" d="M58.188 144.105l6.364 2.426-7.74 20.306-6.365-2.426z" />
        <Rect
          x={38.115}
          y={128.47}
          width={64.221}
          height={7.46}
          rx={3.73}
          transform="rotate(20.867 38.115 128.47)"
          fill="#A0278F"
        />
        <Rect
          x={41.053}
          y={160.83}
          width={35.678}
          height={7.46}
          rx={3.73}
          transform="rotate(20.867 41.053 160.83)"
          fill="#A0278F"
        />
        <Path
          d="M85.902 66.85a6.487 6.487 0 018.372-3.75l4.546 1.733a7.46 7.46 0 014.314 9.628L85.556 67.76l.346-.91z"
          fill="#A0278F"
        />
        <Path d="M103.733 41.019l6.41-5.887-11.323 29.7-3.636-1.386 8.549-22.427z" fill="#F7F7F7" />
        <Path d="M103.79 40.877l1.549-1.331-9.243 24.246-.91-.347 8.604-22.568z" fill="#E2E2E2" />
      </G>
    </G>
    <Defs>
      <ClipPath id="prefix__clip0">
        <Rect x={30} y={30} width={343} height={146} rx={16} fill="#fff" />
      </ClipPath>
    </Defs>
  </Svg>
);
